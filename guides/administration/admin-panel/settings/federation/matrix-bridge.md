---
description: Rocket.Chat and the Matrix Protocol
---

# Matrix Bridge

Rocket.Chat has federation support via the [Matrix](https://matrix.org/) protocol. You can now easily connect with external parties, whether they are using Rocket.Chat or any other Matrix-compatible platform.

### **Key Features**

* Enable or disable Matrix Federation
* Create federated rooms
* Send and receive messages
* Invite federated users to join rooms

{% hint style="info" %}
* Matrix support in Rocket.Chat is currently considered alpha. Expect bugs.
* You need to set up a Matrix homeserver and a dendrite server
* All interactions are performed through slash commands
  * Create a `/federation dm <username>` slash command
  * Remove the `/bridge invite` slash command
{% endhint %}

### Why We Use the Matrix Protocol? <a href="#how-to-setup-rocketchat-with-a-matrix-homeserver" id="how-to-setup-rocketchat-with-a-matrix-homeserver"></a>

* To allow Rocket.Chat acts as a Matrix Application Service (Bridge) to Communicate to an appropriate Matrix homeserver (Dendrite, Synapse, etc.)
* To enable the standards-based interoperable federation

## Set up Rocket.Chat with a Matrix homeserver (Dendrite and Synapse) <a href="#how-to-setup-rocketchat-with-a-matrix-homeserver" id="how-to-setup-rocketchat-with-a-matrix-homeserver"></a>

### System Requirements

* 2GB of RAM
* 2CPU
* 20GB of Storage
* For the cloud hosting, choose [Digital Ocean Droplet](https://docs.rocket.chat/quick-start/upgrading-rocket.chat#upgrading-rocket.chat-digital-ocean-oneclick-install)
* [Ubuntu 20.04](https://docs.rocket.chat/quick-start/installing-and-updating/other-deployment-methods/manual-installation/debian-based-distros/ubuntu)

### **Prerequisites**

* Install [Docker](https://docs.docker.com/get-docker/) and [Docker Compose](https://docs.docker.com/compose/install/)
* A Matrix homeserver ([Dendrite](https://github.com/matrix-org/dendrite) or [Synapse](https://matrix.org/docs/projects/server/synapse)) that supports application services. You need to have access to register an AppService, which usually involves editing the homeserver configuration file.
* Obtain [Lets Encrypt](https://letsencrypt.org/) Certificates
* Configure [nginx](https://docs.rocket.chat/quick-start/installing-and-updating/rapid-deployment-methods/docker-and-docker-compose/docker-containers#5.-installing-nginx-and-ssl-certificate) and setup Nginx Rules
* A domain to host your homeserver on

### Rocket.Chat Matrix Bridge Configuration

Now, you go to **Administration** > **Settings** > **Federation** >**Matrix Bridge**.

![](../../../../../.gitbook/assets/Matrixbridgenew.png)

The following is a brief explanation of each Matrix Bridge **** configuration option:

* **AppService ID** _(_`Federation_Matrix_id`, _automatically generated by Rocket.Chat)**:**_ A unique identifier for the application service.&#x20;
* **Homeserver Token** _(_`Federation_Matrix_hs_token`, _automatically generated by Rocket.Chat)_**:** A unique homeserver token to authenticate requests to application services. Example: _http://localhost:8008_
* **App Service Token** _(_`Federation_Matrix_as_token`, _automatically generated by Rocket.Chat)_**:** A unique application service token to authenticate requests to homeservers.&#x20;
* **Homeserver URL**(`Federation_Matrix_homeserver_url):`The URL of the Matrix server you want to use as a Proxy homeserver.
* **Homeserver Domain** `(Federation_Matrix_homeserver_domain)`**:** In the homeserver domain, use your federation domain. For example: _local.rocket.chat_
* **Bridge URL**(`Federation_Matrix_bridge_url)`**:** The URL for the Matrix bridge.  IT is the location you want your bridge should run.

{% hint style="warning" %}
* Make sure the port that you are using for the bridge is free in your host, otherwise the Rocket.Chat server will crash trying to run a bridge.
* We recommend a new, empty homeserver, to be used with the federation.
* No user should connect to the homeserver with third-party clients, only Rocket.Chat.
{% endhint %}

* **AppService User Localpart**(`Federation_Matrix_bridge_localpart`)**:** The local part of the user associated with the application service. The bot user used to execute some actions.
* **Registration** (`Federation_Matrix_registration_file`): **** Automatically generated and updated by Rocket.Chat based on all the values provided in the above settings.

![Registration Configuration File](../../../../../.gitbook/assets/registration\_file.png)

* Click **Save Changes**.&#x20;

You need to have the `Homeserver Token` and the `AppService Token` keys ready.

### **D**endrite -**Matrix Homeserver Configuration**&#x20;

**Registering as an AppService with Matrix homeserver**&#x20;

* Edit your `dendrite.yaml` file adding the configuration file (rocketchat\_registration.yaml) as per the editing\_dendrite\_yaml image.
* **Dendrite homeserver configuration file**

![Registering as an AppService](../../../../../.gitbook/assets/editing\_dendrite\_yaml.png)

* **Synapse homeserver configuration file**

```json
version: "3"
services:
  synapse-admin:
    container_name: synapse-admin
    hostname: synapse-admin
    image: awesometechnologies/synapse-admin:latest

    # to use the docker-compose as standalone without a local repo clone,
    # replace the context definition with this:
    # context: https://github.com/Awesome-Technologies/synapse-admin.git

    # if you're building on an architecture other than amd64, make sure
    # to define a maximum ram for node. otherwise the build will fail.
    # args:
    #   - NODE_OPTIONS="--max_old_space_size=1024"
    ports:
      - "8080:80"
    restart: unless-stopped
```

* Edit your `config/rocketchat-registration.yaml replacing hs_token` value with the Homeserver Token and`as_token` value with the AppService Token you got from Rocket.Chat.

![Rocket.Chat Registration Config. File](<../../../../../.gitbook/assets/editing\_rocketchat\_registration\_yaml (1).png>)

Finally now we can start matrix up with:

```
docker compose up -d dendrite

```

Now that you have dendrite and Rocket.Chat ready. You can now go into Rocket.Chat and try inviting and sending a message out to a user connected with another server (Rocket.Chat Server, dendrite, synapse and etc.,) through the Matrix Protocol.

### Create a federated room

You can [create a channel in Rocket.Chat](https://docs.rocket.chat/guides/user-guides/rooms/channels/create-a-new-channel) and then invite users.

### Invite a federated user

You can invite users from other servers through the slash command.&#x20;

{% hint style="info" %}
If you invite another Rocket.Chat server, it currently will auto-accept.
{% endhint %}

The structure for the slash command is described below:

/bridge invite @username:server\_name

* _/bridge -the slash command alias_
* _invite - the command you want to execute_
* _@username:server\_name - This is the typical structure for the invite. You need to use the @username you want to invite, followed by the server\_name split by (:)_

{% hint style="info" %}
You must run the slash command before, inside the room you want to federate.
{% endhint %}

### Communicate&#x20;

After you have configured it, you can now send and receive messages within a federated channel.&#x20;

![Communicate](../../../../../.gitbook/assets/Comunication.png)
